# Bpium Webhook ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ–≥–æ–≤–æ—Ä–æ–≤

## üß© –û–ø–∏—Å–∞–Ω–∏–µ

–≠—Ç–æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è **–µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–∑–æ–≤–∞ webhook Bpium** —Å –ø–æ–º–æ—â—å—é GitHub Actions.  
–°—Ü–µ–Ω–∞—Ä–∏–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞—Ç–∞–ª–æ–≥ **¬´–¢–†–£–î–û–í–´–ï –î–û–ì–û–í–û–†–´¬ª** –≤ —Å–∏—Å—Ç–µ–º–µ Bpium –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç—á—ë—Ç –≤ Telegram.

## ‚öôÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

1. **GitHub Actions** (`.github/—Ä–∞–±–æ—á–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã/bipium-webhook.yml`)
   - –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é (cron).
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç HTTP-–∑–∞–ø—Ä–æ—Å –Ω–∞ –∞–¥—Ä–µ—Å:
     ```
     https://kps.bpium.ru/api/webrequest/contracts-daily?async=true
     ```

2. **Bpium ‚Äî –í–Ω–µ—à–Ω–∏–π –∑–∞–ø—Ä–æ—Å `contracts-daily`**
   - –ê–∫—Ç–∏–≤–µ–Ω.
   - –ó–∞–ø—É—Å–∫–∞–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π **¬´–ö–æ–Ω—Ç—Ä–æ–ª—å —Å—Ä–æ–∫–æ–≤ –¥–æ–≥–æ–≤–æ—Ä–æ–≤¬ª**.

3. **Bpium ‚Äî –°—Ü–µ–Ω–∞—Ä–∏–π**
   - –ë–ª–æ–∫ **¬´–ù–∞–π—Ç–∏ –∑–∞–ø–∏—Å–∏¬ª**:
     - –ö–∞—Ç–∞–ª–æ–≥: `–¢–†–£–î–û–í–´–ï –î–û–ì–û–í–û–†–´`
     - –í–∏–¥: `–ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ–≥–æ–≤–æ—Ä–æ–≤2`
     - –§–∏–ª—å—Ç—Ä: –ø–æ–ª–µ ¬´–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –¥–æ–≥–æ–≤–æ—Ä–∞¬ª = –ø–µ—Ä–∏–æ–¥ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Å–µ–≥–æ–¥–Ω—è `+14 –¥–Ω–µ–π`
     - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `contracts`
   - –ë–ª–æ–∫ **¬´–ö–æ–¥ (JavaScript)**:
     - –§–æ—Ä–º–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç –æ—Ç—á—ë—Ç–∞ (—Å–º. –∫–æ–¥ –Ω–∏–∂–µ)
     - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `message`
   - –ë–ª–æ–∫ **¬´–í–µ–±-–∑–∞–ø—Ä–æ—Å¬ª**:
     - –ú–µ—Ç–æ–¥: `POST`
     - –ê–¥—Ä–µ—Å:
       ```
       "https://api.telegram.org/bot<–¢–û–ö–ï–ù>/sendMessage"
       ```
     - –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:
       ```json
       `{"chat_id":"<CHAT_ID>","text":"${message}","parse_mode":"Markdown"}`
       ```
     - –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö: `JSON`
     - –ë–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

## üß† –ö–æ–¥ JavaScript

```javascript
var FIO_FIELD_ID = "2";   // –ø–æ–ª–µ "–§–ò–û"

if (!Array.isArray(contracts)) {
    contracts = contracts ? [contracts] : [];
}

var now = moment().format("DD.MM.YYYY");
var message;

if (contracts.length === 0) {
    message = "üïì *–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ–≥–æ–≤–æ—Ä–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω.*\n" +
              "_–î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:_ " + now + "\n\n" +
              "–ü–æ–¥—Ö–æ–¥—è—â–∏—Ö –¥–æ–≥–æ–≤–æ—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.";
} else if (contracts.length === 1) {
    var fio = contracts[0].values[FIO_FIELD_ID] || "";
    message = "‚úÖ *–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ–≥–æ–≤–æ—Ä–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ.*\n" +
              "_–î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:_ " + now + "\n\n" +
              "–ù–∞–π–¥–µ–Ω *1 –¥–æ–≥–æ–≤–æ—Ä* ‚Äî " + fio + ".";
} else {
    var lines = contracts.map(function(rec, i) {
        return (i + 1) + ". " + (rec.values[FIO_FIELD_ID] || "");
    });
    message = "‚ö†Ô∏è *–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ–≥–æ–≤–æ—Ä–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ.*\n" +
              "_–î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:_ " + now + "\n\n" +
              "–ù–∞–π–¥–µ–Ω–æ *" + contracts.length + " –¥–æ–≥–æ–≤–æ—Ä–æ–≤:*\n" +
              lines.join("\n");
}

return message;

üì¨ –ü—Ä–∏–º–µ—Ä—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ Telegram
–ù–µ—Ç –¥–æ–≥–æ–≤–æ—Ä–æ–≤
üïì –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ–≥–æ–≤–æ—Ä–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω.
–î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: 11.11.2025
–ü–æ–¥—Ö–æ–¥—è—â–∏—Ö –¥–æ–≥–æ–≤–æ—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.

–û–¥–∏–Ω –¥–æ–≥–æ–≤–æ—Ä
‚úÖ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ–≥–æ–≤–æ—Ä–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ.
–î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: 11.11.2025
–ù–∞–π–¥–µ–Ω 1 –¥–æ–≥–æ–≤–æ—Ä ‚Äî –ò–≤–∞–Ω–æ–≤–∞ –ê.–ê.

–ù–µ—Å–∫–æ–ª—å–∫–æ –¥–æ–≥–æ–≤–æ—Ä–æ–≤
‚ö†Ô∏è –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ–≥–æ–≤–æ—Ä–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ.
–î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: 11.11.2025
–ù–∞–π–¥–µ–Ω–æ 2 –¥–æ–≥–æ–≤–æ—Ä–∞:
1. –ò–≤–∞–Ω–æ–≤–∞ –ê.–ê.
2. –ü–µ—Ç—Ä–æ–≤ –ë.–ë.

üß≠ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö GitHub Actions, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å Bpium;
–≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π –∏ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤;
–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –¥—Ä—É–≥–∏–º —á–ª–µ–Ω–∞–º –∫–æ–º–∞–Ω–¥—ã –≥–æ—Ç–æ–≤—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏;
–ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π.

